{% extends "base.html" %}

{% block title %}{{ duck.name }} - Playground{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Home</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for(duck.type + '.duck_page') }}">{{ duck.name }}</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Playground</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-body">
                    <h1 class="card-title">Mujoco Playground</h1>
                    <p class="card-text">Test your {{ duck.name }} in a simulated environment before building the real one.</p>
                    
                    <div class="mb-4">
                        <div class="form-group mb-3">
                            <label for="model-select">Model:</label>
                            <select class="form-select" id="model-select">
                                <option value="latest">Latest Model</option>
                                <option value="best">Best Model</option>
                                {% for model in available_models %}
                                <option value="{{ model.id }}">{{ model.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="env-select">Environment:</label>
                            <select class="form-select" id="env-select">
                                <option value="joystick">Joystick Control</option>
                                <option value="standing">Standing Balance</option>
                            </select>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="task-select">Task:</label>
                            <select class="form-select" id="task-select">
                                <option value="flat_terrain">Flat Ground</option>
                                <option value="slope">Sloped Surface</option>
                                <option value="stairs">Staircase</option>
                                <option value="obstacles">Obstacle Course</option>
                            </select>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="speed-control">Speed:</label>
                            <input type="range" class="form-range" id="speed-control" min="0" max="100" value="50">
                        </div>
                        
                        <button class="btn btn-primary" id="launch-btn">
                            <i class="fas fa-play"></i> Launch Playground
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-body">
                    <h2>Quick Links</h2>
                    <div class="list-group">
                        <a href="{{ url_for(duck.type + '.bom') }}" class="list-group-item list-group-item-action">
                            <i class="fas fa-list"></i> Bill of Materials
                        </a>
                        <a href="{{ url_for(duck.type + '.stl_models') }}" class="list-group-item list-group-item-action">
                            <i class="fas fa-cube"></i> STL Models
                        </a>
                        <a href="{{ url_for(duck.type + '.assembly') }}" class="list-group-item list-group-item-action">
                            <i class="fas fa-tools"></i> Assembly Guide
                        </a>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h2>Playground Tips</h2>
                    <ul class="list-unstyled">
                        {% for tip in playground_tips %}
                        <li class="mb-2">
                            <i class="fas fa-lightbulb text-warning"></i> {{ tip }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const launchBtn = document.getElementById('launch-btn');
    const modelSelect = document.getElementById('model-select');
    const envSelect = document.getElementById('env-select');
    const taskSelect = document.getElementById('task-select');
    const speedControl = document.getElementById('speed-control');

    launchBtn.addEventListener('click', function() {
        const model = modelSelect.value;
        const env = envSelect.value;
        const task = taskSelect.value;
        const speed = speedControl.value;
        const variant = '{{ duck.variant.id }}';  // Get the current variant ID

        // Debug logging
        console.log('Launching playground with parameters:', {
            model: model,
            env: env,
            task: task,
            speed: speed,
            variant: variant
        });

        // Disable the button while launching
        launchBtn.disabled = true;
        launchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Launching...';

        // Launch the playground with variant parameter
        const url = `./playground/launch?model=${model}&env=${env}&task=${task}&speed=${speed}&variant=${variant}`;
        console.log('Launch URL:', url);

        fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Playground launched successfully!');
                } else {
                    alert(`Failed to launch playground: ${data.message}`);
                }
            })
            .catch(error => {
                console.error('Error launching playground:', error);
                alert('Failed to launch playground. Please try again.');
            })
            .finally(() => {
                // Re-enable the button
                launchBtn.disabled = false;
                launchBtn.innerHTML = '<i class="fas fa-play"></i> Launch Playground';
            });
    });
});
</script>
{% endblock %} 